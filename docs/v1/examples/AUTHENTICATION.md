# Authentication Examples for JMeter Tests

This guide shows how to add authentication to JMeter test plans generated by jmeter-gen.

## Overview

JMeter supports various authentication methods. After generating a JMX file with jmeter-gen, you can add authentication using JMeter GUI or by manually editing the JMX file.

## 1. Bearer Token (JWT)

### JMeter GUI Method

1. Open the generated JMX file in JMeter
2. Right-click on Thread Group -> Add -> Config Element -> HTTP Header Manager
3. Add header:
   - Name: `Authorization`
   - Value: `Bearer your-jwt-token-here`

### Manual JMX Edit

Add this inside the ThreadGroup's hashTree, before HTTP Samplers:

```xml
<HeaderManager guiclass="HeaderPanel" testclass="HeaderManager" testname="HTTP Header Manager" enabled="true">
  <collectionProp name="HeaderManager.headers">
    <elementProp name="" elementType="Header">
      <stringProp name="Header.name">Authorization</stringProp>
      <stringProp name="Header.value">Bearer ${__P(auth.token,your-default-token)}</stringProp>
    </elementProp>
  </collectionProp>
</HeaderManager>
<hashTree/>
```

### Running with Token

```bash
jmeter -n -t test.jmx -Jauth.token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

## 2. Basic Authentication

### JMeter GUI Method

1. Open the generated JMX file in JMeter
2. Right-click on Thread Group -> Add -> Config Element -> HTTP Authorization Manager
3. Add entry:
   - Base URL: `https://api.example.com`
   - Username: `your-username`
   - Password: `your-password`
   - Mechanism: `BASIC`

### Manual JMX Edit

Add this inside the ThreadGroup's hashTree, before HTTP Samplers:

```xml
<AuthManager guiclass="AuthPanel" testclass="AuthManager" testname="HTTP Authorization Manager" enabled="true">
  <collectionProp name="AuthManager.auth_list">
    <elementProp name="" elementType="Authorization">
      <stringProp name="Authorization.url">https://api.example.com</stringProp>
      <stringProp name="Authorization.username">${__P(auth.username,admin)}</stringProp>
      <stringProp name="Authorization.password">${__P(auth.password,secret)}</stringProp>
      <stringProp name="Authorization.domain"></stringProp>
      <stringProp name="Authorization.realm"></stringProp>
      <stringProp name="Authorization.mechanism">BASIC</stringProp>
    </elementProp>
  </collectionProp>
</AuthManager>
<hashTree/>
```

### Running with Credentials

```bash
jmeter -n -t test.jmx -Jauth.username=admin -Jauth.password=secret123
```

## 3. API Key (Header)

### JMeter GUI Method

1. Open the generated JMX file in JMeter
2. Right-click on Thread Group -> Add -> Config Element -> HTTP Header Manager
3. Add header:
   - Name: `X-API-Key` (or your API's header name)
   - Value: `your-api-key`

### Manual JMX Edit

```xml
<HeaderManager guiclass="HeaderPanel" testclass="HeaderManager" testname="HTTP Header Manager" enabled="true">
  <collectionProp name="HeaderManager.headers">
    <elementProp name="" elementType="Header">
      <stringProp name="Header.name">X-API-Key</stringProp>
      <stringProp name="Header.value">${__P(api.key,default-key)}</stringProp>
    </elementProp>
  </collectionProp>
</HeaderManager>
<hashTree/>
```

### Running with API Key

```bash
jmeter -n -t test.jmx -Japi.key=abc123xyz
```

## 4. API Key (Query Parameter)

If your API expects the key as a query parameter (e.g., `?api_key=xxx`):

### JMeter GUI Method

1. Open each HTTP Sampler
2. In Parameters section, add:
   - Name: `api_key`
   - Value: `${__P(api.key,default-key)}`

### Alternative: User Defined Variables

1. Right-click Thread Group -> Add -> Config Element -> User Defined Variables
2. Add variable: `API_KEY` = `your-api-key`
3. In HTTP Samplers, use `${API_KEY}` in path or parameters

## 5. OAuth 2.0 (Token Refresh)

For OAuth 2.0 with token refresh, you need a more complex setup:

### Setup Steps

1. Add HTTP Sampler for token endpoint (before other requests)
2. Extract token using JSON Extractor
3. Use token in subsequent requests

### Token Request Sampler

```xml
<HTTPSamplerProxy guiclass="HttpTestSampleGui" testclass="HTTPSamplerProxy" testname="Get OAuth Token" enabled="true">
  <stringProp name="HTTPSampler.domain">auth.example.com</stringProp>
  <stringProp name="HTTPSampler.port">443</stringProp>
  <stringProp name="HTTPSampler.protocol">https</stringProp>
  <stringProp name="HTTPSampler.path">/oauth/token</stringProp>
  <stringProp name="HTTPSampler.method">POST</stringProp>
  <boolProp name="HTTPSampler.postBodyRaw">true</boolProp>
  <elementProp name="HTTPsampler.Arguments" elementType="Arguments">
    <collectionProp name="Arguments.arguments">
      <elementProp name="" elementType="HTTPArgument">
        <stringProp name="Argument.value">grant_type=client_credentials&amp;client_id=${CLIENT_ID}&amp;client_secret=${CLIENT_SECRET}</stringProp>
        <stringProp name="Argument.metadata">=</stringProp>
      </elementProp>
    </collectionProp>
  </elementProp>
</HTTPSamplerProxy>
```

### JSON Extractor (after token request)

```xml
<JSONPostProcessor guiclass="JSONPostProcessorGui" testclass="JSONPostProcessor" testname="Extract Access Token" enabled="true">
  <stringProp name="JSONPostProcessor.referenceNames">ACCESS_TOKEN</stringProp>
  <stringProp name="JSONPostProcessor.jsonPathExprs">$.access_token</stringProp>
  <stringProp name="JSONPostProcessor.match_numbers">1</stringProp>
</JSONPostProcessor>
```

### Using Token in Requests

Add Header Manager with:
- Name: `Authorization`
- Value: `Bearer ${ACCESS_TOKEN}`

## Best Practices

1. **Never hardcode credentials** - Use JMeter properties (`${__P(name,default)}`) or variables
2. **Use CSV for multiple users** - Load credentials from CSV Data Set Config for load testing
3. **Secure credential storage** - Keep credentials in separate properties file, not in JMX
4. **Token caching** - For OAuth, consider caching tokens to avoid excessive token requests

## Example: Running Tests with Auth

```bash
# Bearer token
jmeter -n -t api-test.jmx -Jauth.token="eyJhbG..."

# Basic auth
jmeter -n -t api-test.jmx -Jauth.username=user -Jauth.password=pass

# API key
jmeter -n -t api-test.jmx -Japi.key=abc123

# From properties file
jmeter -n -t api-test.jmx -q auth.properties
```

Example `auth.properties`:
```properties
auth.token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
auth.username=testuser
auth.password=testpass
api.key=your-api-key-here
```
